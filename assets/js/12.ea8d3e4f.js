(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{408:function(t,a,s){"use strict";s.r(a);var n=s(13),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"背景故事"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#背景故事"}},[t._v("#")]),t._v(" 背景故事")]),t._v(" "),s("p",[t._v("上次由于想要升级一下 "),s("code",[t._v("yarn")]),t._v("，然后自动升级 "),s("code",[t._v("icu4c")]),t._v(" 组件，导致 PHP 无法运行；索性就把所有 brew 安装的组件都升级了一遍。然后就出现了喜闻乐见的 PHP Oracle 驱动找不到了。")]),t._v(" "),s("blockquote",[s("p",[t._v("Homebrew 做的真的是挺烂的！")])]),t._v(" "),s("h2",{attrs:{id:"具体步骤"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#具体步骤"}},[t._v("#")]),t._v(" 具体步骤")]),t._v(" "),s("p",[t._v("首先完全不推荐使用 Pear 或者 Pecl，又老又旧难安装反正一堆的问题。所以这里直接下载 PHP 源码进行编译。这里要注意的事，macOS 预装的 PHP 因为 SIP 的存在是不能改动的；这里只讨论 brew 安装的版本。")]),t._v(" "),s("h3",{attrs:{id:"下载源码"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#下载源码"}},[t._v("#")]),t._v(" 下载源码")]),t._v(" "),s("p",[t._v("先查看 PHP 版本 "),s("code",[t._v("php -v")]),t._v(" 例如我使用的是 "),s("code",[t._v("7.4.8")]),t._v("（这里也要确保 php 是 brew 安装的版本，具体可以使用 "),s("code",[t._v("which php")]),t._v(" "),s("code",[t._v("type -a php")]),t._v(" 来查看用的哪一个）")]),t._v(" "),s("p",[t._v("然后去 php.net 下载匹配版本的源码，如果国内下载不动就挂代理")]),t._v(" "),s("h3",{attrs:{id:"检查工作"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#检查工作"}},[t._v("#")]),t._v(" 检查工作")]),t._v(" "),s("p",[t._v("brew 默认安装的只把 php 链接到了 "),s("code",[t._v("/usr/local/bin/")]),t._v("，如果要编译我们还要准备其他几个可执行文件；建立符号链接到 "),s("code",[t._v("/usr/local/bin/")]),t._v(" 下，否则如果用到了预装的可执行文件，会导致各种问题")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ln")]),t._v(" -s /usr/local/opt/php/bin/phpize /usr/local/bin/phpize\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ln")]),t._v(" -s /usr/local/opt/php/bin/php-config /usr/local/bin/php-config\n")])])]),s("p",[t._v("执行 "),s("code",[t._v("which phpize")]),t._v("、"),s("code",[t._v("which php-config")]),t._v(" 确认，如果还没有生效执行一下 "),s("code",[t._v("hash -r")])]),t._v(" "),s("p",[t._v("确保系统中已经有 Oracle Instantclient，没有就去 Oracle 官网下载。例如我使用的是 12.2 版本的，并且已经放在了目录 "),s("code",[t._v("/usr/local/instantclient_12_2")])]),t._v(" "),s("h3",{attrs:{id:"开始编译"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#开始编译"}},[t._v("#")]),t._v(" 开始编译")]),t._v(" "),s("p",[t._v("解压 PHP 源码到某个目录，例如 "),s("code",[t._v("~/Desktop/Temp/php-7.4.8/")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# OCI8 编译")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" ~/Desktop/Temp/php-7.4.8/ext/oci8/\nphpize\n./configure --with-oci8"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("instantclient,/usr/local/instantclient_12_2,12.2\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v("\n\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# PDO_OCI 编译")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" ~/Desktop/Temp/php-7.4.8/ext/pdo_oci/\nphpize\n./configure --with-pdo-oci"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("instantclient,/usr/local/instantclient_12_2,12.2\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v("\n")])])]),s("h3",{attrs:{id:"配置-php-ini"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置-php-ini"}},[t._v("#")]),t._v(" 配置 php.ini")]),t._v(" "),s("p",[t._v("在 php.ini 中加入（php.ini 的位置使用 "),s("code",[t._v("php --ini")]),t._v(" 查看）")]),t._v(" "),s("div",{staticClass:"language-ini extra-class"},[s("pre",{pre:!0,attrs:{class:"language-ini"}},[s("code",[s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("extension")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("oci8.so")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("extension")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("pdo_oci.so")]),t._v("\n")])])]),s("p",[t._v("配置完成之后可以直接使用 "),s("code",[t._v("php -m")]),t._v(" 查看启用扩展，重启一下 Apache 查看 "),s("code",[t._v("phpinfo()")])]),t._v(" "),s("p",[t._v("完")])])}),[],!1,null,null,null);a.default=e.exports}}]);